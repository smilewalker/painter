var Painter=function(a){this.info=a;this.init()};
Painter.prototype={initData:function(){this.lastY=this.lastX=0;this.isPaint=!1;this.history=[];this.count=0},setConfig:function(){this.config={lineWidth:this.info.lineWidth||5,lineJoin:this.info.lineJoin||"round",shadowBlur:this.info.shadowBlur||0,shadowColor:this.info.shadowColor||"red",boardW:this.info.cvaWidth||600,boardH:this.info.cvaHeight||400,layerBg:this.info.layerBg||"rgba(255, 255, 255, 0.8)"}},setWH:function(){this.cva.setAttribute("width",this.config.boardW);this.cva.setAttribute("height",
this.config.boardH)},setLayer:function(){this.ctx.fillStyle=this.config.layerBg;this.ctx.fillRect(0,0,this.config.boardW,this.config.boardH);this.ctx.globalCompositeOperation="destination-out"},setPen:function(){this.ctx.lineJoin=this.config.lineJoin;this.ctx.strokeStyle=this.config.strokeStyle;this.ctx.shadowBlur=this.config.shadowBlur;this.ctx.shadowColor=this.config.shadowColor},setPenWidth:function(a){this.ctx.lineWidth=a||this.config.lineWidth},historyLog:function(){this.history[this.count]=
this.ctx.getImageData(0,0,this.config.boardW,this.config.boardH);this.count++},draw:function(a,b){this.isPaint&&(this.ctx.beginPath(),this.ctx.moveTo(this.lastX,this.lastY),this.ctx.lineTo(a,b),this.ctx.closePath(),this.ctx.stroke());this.lastX=a;this.lastY=b},touchF:function(a){a.preventDefault();var b=a.changedTouches[0];switch(a.type){case "touchstart":0==this.count&&this.historyLog();this.draw(b.clientX-this.cva.offsetLeft,b.clientY-this.cva.offsetTop);this.ctx.save();this.isPaint=!0;break;case "touchmove":this.isPaint&&
this.draw(b.pageX-this.cva.offsetLeft,b.pageY-this.cva.offsetTop);break;case "touchend":this.ctx.restore();this.isPaint&&this.historyLog();this.isPaint=!1;break;default:this.isPaint=!1}},cancelPaint:function(a){this.cancelBtn.onclick=this.bind(this,this._cancelPaint)},_cancelPaint:function(){this.history.length&&1<this.count&&(this.count--,this.ctx.putImageData(this.history[this.count-1],0,0))},clearPaint:function(a){this.clearBtn.onclick=this.bind(this,this._clearPaint)},_clearPaint:function(){0<
this.history.length&&this.ctx.putImageData(this.history[0],0,0);this.initData()},bind:function(a,b){return function(){return b.apply(a,arguments)}},init:function(){this.cva=document.getElementById(this.info.layer);this.cancelBtn=document.getElementById(this.info.cancelButton);this.clearBtn=document.getElementById(this.info.clearButton);this.ctx=this.cva.getContext("2d");this.initData();this.setConfig();this.setWH();this.setLayer();this.setPen();this.setPenWidth();this.cancelPaint(this.cancleBtn);
this.clearPaint(this.clearBtn);this.cva.addEventListener("touchstart",this.touchF.bind(this),!1);this.cva.addEventListener("touchmove",this.touchF.bind(this),!1);this.cva.addEventListener("touchend",this.touchF.bind(this),!1)}};